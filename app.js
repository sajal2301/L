// JS logic omitted for brevity in generation